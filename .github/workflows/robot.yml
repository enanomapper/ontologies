name: ROBOT-commands
on:
    workflow_dispatch:
    schedule:
    - cron: "*/5 * * * *"
jobs:
    robot-workflows:
        runs-on: ubuntu-latest
        steps:
        - name: checkout repo
          uses: actions/checkout@v2
        - name: get robot
          run: |
            ls
            wget https://raw.githubusercontent.com/ontodev/robot/master/bin/robot
            wget https://github.com/ontodev/robot/releases/download/v1.9.0/robot.jar
            chmod 777 robo*
    
        - name: merge
          run: sh robot merge -i enanomapper.owl -o enanomapper-full-temp.owl
        - name: report
          run: sh robot report --fail-on none -i enanomapper-full-temp.owl -o robot-report/report.tsv
        - name: diff
          run: |
            sh robot diff --left enanomapper-full.owl --right enanomapper-full-temp.owl --output robot-report/diff.txt
            rm enanomapper-full.owl
            mv enanomapper-full-temp.owl enanomapper-full.owl
        - name: reason
          run: sh robot reason --reasoner ELK --annotate-inferred-axioms true --input enanomapper-full.owl --output enanomapper-reasoned.owl
  
  # Commit and push
        - name: Commit OWL files
          run: |
            git add enanomapper-full.owl
            git add ./robot-report/*
            git config --local user.email "action@github.com"
            git config --local user.name "GitHub Action"
            git commit -m "Actions - QC" ./robot-report/* enanomapper-full.owl
        - name: Push changes
          uses: ad-m/github-push-action@master
          with:
            github_token: ${ secrets.GITHUB_TOKEN }
            branch: master   
  